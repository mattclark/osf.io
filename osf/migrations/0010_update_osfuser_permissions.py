# -*- coding: utf-8 -*-
# Generated by Django 1.9 on 2017-04-05 17:30
from __future__ import unicode_literals

from django.db import migrations, models
from django.contrib.auth.models import Permission, Group


def get_permissions():
    return Permission.objects.filter(
        models.Q(codename='change_osfuser') |
        models.Q(codename='delete_osfuser')
    )


def fix_osfuser_permissions(*args):
    osf_admin = Group.objects.get(name='osf_admin')
    osf_admin.permissions.add(*get_permissions())
    osf_admin.save()


def revert_user_permissions(*args):
    osf_admin = Group.objects.get(name='osf_admin')
    osf_admin.permissions.remove(*get_permissions())
    osf_admin.save()


class Migration(migrations.Migration):

    dependencies = [
        ('osf', '0009_auto_20170406_1614'),
    ]

    operations = [
        migrations.AlterModelOptions(
            name='osfuser',
            options={'permissions': (('view_osfuser', 'Can view user details'),)},
        ),
        migrations.RunPython(fix_osfuser_permissions, revert_user_permissions),
    ]
